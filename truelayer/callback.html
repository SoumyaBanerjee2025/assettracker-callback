<!doctype html>
<meta charset="utf-8">
<title>AssetTracker • BankLink Callback</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  body{font:16px -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
       padding:24px;max-width:560px;margin:auto;line-height:1.4}
  a{font-weight:600}
  #fallback{display:none}
</style>
<script>
(function () {
  function toObj(qs) {
    const out = {};
    if (!qs) return out;
    for (const [k, v] of new URLSearchParams(qs)) out[k] = v;
    return out;
  }

  // Collect params from ?query and #hash (just in case)
  const params = Object.assign({}, toObj(location.search), toObj(location.hash?.slice(1)));

  // Build the deep link your app expects: assettracker://banklink?... 
  let deeplink = "assettracker://banklink";
  const parts = [];

  if (params.code)  parts.push("code="  + encodeURIComponent(params.code));
  if (params.state) parts.push("state=" + encodeURIComponent(params.state));
  if (params.error) {
    parts.unshift("status=error");
    parts.push("error=" + encodeURIComponent(params.error));
    if (params.error_description) {
      parts.push("error_description=" + encodeURIComponent(params.error_description));
    }
  } else {
    parts.unshift("status=success");
  }

  if (parts.length) deeplink += "?" + parts.join("&");

  // Try immediate redirect into the app
  window.location.replace(deeplink);

  // Fallback UI if the scheme didn't open
  setTimeout(function () {
    document.getElementById("link").href = deeplink;
    document.getElementById("debug").textContent = JSON.stringify(params, null, 2);
    document.getElementById("fallback").style.display = "block";
  }, 900);
})();
</script>
<body>
  <h1>Returning to AssetTracker…</h1>
  <p>If you’re not redirected automatically, tap:</p>
  <p><a id="link" href="#">Open AssetTracker</a></p>
  <details>
    <summary>Show debug</summary>
    <pre id="debug"></pre>
  </details>
  <div id="fallback"></div>
</body>
